<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>// Place global declarations here.
</declaration>
	<template>
		<name>RegistrationV2</name>
		<parameter>chan &amp;reqRegistration, chan &amp;registrationACK</parameter>
		<declaration>clock timeoutClock;

const int maxTimeout = 420;</declaration>
		<location id="id0" x="-161" y="-229">
			<name x="-204" y="-263">ACKtimeout</name>
		</location>
		<location id="id1" x="-714" y="-238">
			<name x="-748" y="-272">InvalidData</name>
		</location>
		<location id="id2" x="-909" y="-102">
			<name x="-926" y="-136">Idle</name>
			<label kind="comments" x="-1020" y="-110">IoT device</label>
		</location>
		<location id="id3" x="-714" y="-102">
			<name x="-773" y="-85">ReadRAMLData</name>
		</location>
		<location id="id4" x="-459" y="-102">
			<name x="-544" y="-85">RequestRegistration</name>
		</location>
		<location id="id5" x="-161" y="-102">
			<name x="-144" y="-136">PendingServerACK</name>
		</location>
		<location id="id6" x="-552" y="59">
			<name x="-595" y="76">ServerACK</name>
		</location>
		<init ref="id2"/>
		<transition id="id7">
			<source ref="id5"/>
			<target ref="id0"/>
			<label kind="guard" x="-153" y="-195">timeoutClock &gt; maxTimeout</label>
		</transition>
		<transition id="id8">
			<source ref="id3"/>
			<target ref="id1"/>
		</transition>
		<transition id="id9">
			<source ref="id6"/>
			<target ref="id2"/>
			<nail x="-909" y="59"/>
		</transition>
		<transition id="id10">
			<source ref="id5"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-425" y="68">registrationACK?</label>
			<nail x="-161" y="59"/>
		</transition>
		<transition id="id11">
			<source ref="id4"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="-391" y="-144">reqRegistration!</label>
			<label kind="assignment" x="-391" y="-127">timeoutClock := 0</label>
		</transition>
		<transition id="id12">
			<source ref="id3"/>
			<target ref="id4"/>
		</transition>
		<transition id="id13">
			<source ref="id2"/>
			<target ref="id3"/>
		</transition>
	</template>
	<template>
		<name>RDServer</name>
		<parameter>chan &amp;registrationACK, chan &amp;reqRegistration, chan &amp;reqDiscovery, chan &amp;discoveryACK, int &amp;reqType</parameter>
		<location id="id14" x="255" y="102">
			<name x="212" y="68">RetrievalError</name>
		</location>
		<location id="id15" x="255" y="8">
			<name x="272" y="-17">InsertionError</name>
		</location>
		<location id="id16" x="-25" y="8">
			<name x="-8" y="-25">ParsingError</name>
		</location>
		<location id="id17" x="-399" y="51">
			<name x="-442" y="18">Idle</name>
		</location>
		<location id="id18" x="255" y="-68">
			<name x="263" y="-102">InsertIntoDB</name>
		</location>
		<location id="id19" x="255" y="178">
			<name x="263" y="153">retrieveFromDB</name>
		</location>
		<location id="id20" x="-27" y="127">
			<name x="-37" y="93">List</name>
		</location>
		<location id="id21" x="-25" y="238">
			<name x="-42" y="204">Item</name>
		</location>
		<location id="id22" x="-246" y="187">
			<name x="-365" y="204">DiscoveryRequested</name>
		</location>
		<location id="id23" x="-246" y="-68">
			<name x="-322" y="-102">RegistrationRequested</name>
		</location>
		<location id="id24" x="-25" y="-68">
			<name x="-59" y="-102">parseData</name>
		</location>
		<init ref="id17"/>
		<transition id="id25">
			<source ref="id19"/>
			<target ref="id14"/>
		</transition>
		<transition id="id26">
			<source ref="id18"/>
			<target ref="id15"/>
		</transition>
		<transition id="id27">
			<source ref="id19"/>
			<target ref="id17"/>
			<label kind="synchronisation" x="-119" y="306">discoveryACK!</label>
			<nail x="255" y="306"/>
			<nail x="-399" y="306"/>
		</transition>
		<transition id="id28">
			<source ref="id21"/>
			<target ref="id19"/>
			<nail x="119" y="238"/>
		</transition>
		<transition id="id29">
			<source ref="id20"/>
			<target ref="id19"/>
			<nail x="119" y="127"/>
		</transition>
		<transition id="id30">
			<source ref="id22"/>
			<target ref="id21"/>
			<label kind="guard" x="-161" y="204">reqType == 1</label>
			<nail x="-161" y="238"/>
		</transition>
		<transition id="id31">
			<source ref="id22"/>
			<target ref="id20"/>
			<label kind="guard" x="-153" y="102">reqType == 0</label>
			<nail x="-161" y="127"/>
		</transition>
		<transition id="id32">
			<source ref="id17"/>
			<target ref="id22"/>
			<label kind="synchronisation" x="-246" y="59">reqDiscovery?</label>
			<nail x="-246" y="85"/>
		</transition>
		<transition id="id33">
			<source ref="id24"/>
			<target ref="id16"/>
		</transition>
		<transition id="id34">
			<source ref="id18"/>
			<target ref="id17"/>
			<label kind="synchronisation" x="-85" y="-221">registrationACK!</label>
			<nail x="255" y="-195"/>
			<nail x="-399" y="-195"/>
		</transition>
		<transition id="id35">
			<source ref="id24"/>
			<target ref="id18"/>
		</transition>
		<transition id="id36">
			<source ref="id23"/>
			<target ref="id24"/>
		</transition>
		<transition id="id37">
			<source ref="id17"/>
			<target ref="id23"/>
			<label kind="synchronisation" x="-246" y="0">reqRegistration?</label>
			<nail x="-246" y="8"/>
		</transition>
	</template>
	<template>
		<name>DiscoveryV2</name>
		<parameter>chan &amp;reqDiscovery, chan &amp;discoveryACK, int &amp;reqType</parameter>
		<declaration>clock timeoutClock;

const int maxTimeout = 420;</declaration>
		<location id="id38" x="399" y="-170">
			<name x="352" y="-205">DataReceived</name>
		</location>
		<location id="id39" x="-263" y="-178">
			<name x="-289" y="-212">Idle</name>
			<label kind="comments" x="-374" y="-170">IoT Client</label>
		</location>
		<location id="id40" x="170" y="-170">
			<name x="162" y="-153">Pending</name>
		</location>
		<location id="id41" x="170" y="-323">
			<name x="144" y="-357">Timeout</name>
		</location>
		<location id="id42" x="-68" y="-85">
			<name x="-110" y="-119">RequestItem</name>
		</location>
		<location id="id43" x="-68" y="-263">
			<name x="-111" y="-297">RequestList</name>
		</location>
		<init ref="id39"/>
		<transition id="id44">
			<source ref="id43"/>
			<target ref="id40"/>
			<label kind="synchronisation" x="-34" y="-263">reqDiscovery!</label>
			<label kind="assignment" x="-34" y="-246">timeoutClock := 0</label>
			<nail x="102" y="-263"/>
		</transition>
		<transition id="id45">
			<source ref="id38"/>
			<target ref="id39"/>
			<nail x="399" y="51"/>
			<nail x="-263" y="51"/>
		</transition>
		<transition id="id46">
			<source ref="id40"/>
			<target ref="id41"/>
			<label kind="guard" x="178" y="-272">timeoutClock &gt; maxTimeout</label>
		</transition>
		<transition id="id47">
			<source ref="id40"/>
			<target ref="id38"/>
			<label kind="synchronisation" x="212" y="-195">discoveryACK?</label>
		</transition>
		<transition id="id48">
			<source ref="id42"/>
			<target ref="id40"/>
			<label kind="synchronisation" x="-34" y="-85">reqDiscovery!</label>
			<label kind="assignment" x="-34" y="-68">timeoutClock := 0</label>
			<nail x="93" y="-85"/>
		</transition>
		<transition id="id49">
			<source ref="id39"/>
			<target ref="id42"/>
			<label kind="guard" x="-238" y="-85">reqType == 1</label>
			<nail x="-195" y="-85"/>
		</transition>
		<transition id="id50">
			<source ref="id39"/>
			<target ref="id43"/>
			<label kind="guard" x="-255" y="-289">reqType == 0</label>
			<nail x="-195" y="-263"/>
		</transition>
	</template>
	<system>
chan reqRegistration, registrationACK;
registrationV2 = RegistrationV2(reqRegistration, registrationACK);


chan reqDiscovery, discoveryACK;
int reqType; //fake enum 0... list, 1...item
discoveryV2 = DiscoveryV2(reqDiscovery, discoveryACK, reqType);


rdServer = RDServer(registrationACK, reqRegistration, reqDiscovery, discoveryACK, reqType);

// List one or more processes to be composed into a system.
system registrationV2, discoveryV2, rdServer;
</system>
	<queries>
		<query>
			<formula/>
			<comment/>
		</query>
	</queries>
</nta>
